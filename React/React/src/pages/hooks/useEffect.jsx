/* 
  ç¼–å†™ Effect éœ€è¦éµå¾ªä»¥ä¸‹ä¸‰ä¸ªè§„åˆ™ï¼š
    1. å£°æ˜ Effect é»˜è®¤æƒ…å†µä¸‹ï¼ŒEffect ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½ä¼šæ‰§è¡Œ
    2. æŒ‡å®š Effect ä¾èµ– å¤§å¤šæ•° Effect åº”è¯¥æŒ‰éœ€æ‰§è¡Œï¼Œè€Œä¸æ˜¯åœ¨æ¯æ¬¡æ¸²æŸ“åéƒ½æ‰§è¡Œ
    3. å¿…è¦æ—¶æ·»åŠ æ¸…ç†ï¼ˆcleanupï¼‰å‡½æ•°ã€‚æœ‰æ—¶ Effect éœ€è¦æŒ‡å®šå¦‚ä½•åœæ­¢ã€æ’¤é”€ï¼Œæˆ–è€…æ¸…é™¤å®ƒçš„æ•ˆæœ

  åŸåˆ™ï¼šå¦‚æœè¿™ä¸ªé€»è¾‘æ˜¯ç”±æŸä¸ªç‰¹å®šçš„äº¤äº’å¼•èµ·çš„ï¼Œè¯·å°†å®ƒä¿ç•™åœ¨ç›¸åº”çš„äº‹ä»¶å¤„ç†å‡½æ•°ä¸­ã€‚å¦‚æœæ˜¯ç”±ç”¨æˆ·åœ¨å±å¹•ä¸Š çœ‹åˆ° ç»„ä»¶æ—¶å¼•èµ·çš„ï¼Œè¯·å°†å®ƒä¿ç•™åœ¨ Effect ä¸­  

  æ‘˜è¦
    1. ä¸äº‹ä»¶ä¸åŒï¼ŒEffect æ˜¯ç”±æ¸²æŸ“æœ¬èº«ï¼Œè€Œéç‰¹å®šäº¤äº’å¼•èµ·çš„
    2. Effect å…è®¸ä½ å°†ç»„ä»¶ä¸æŸäº›å¤–éƒ¨ç³»ç»Ÿï¼ˆç¬¬ä¸‰æ–¹ APIã€ç½‘ç»œç­‰ï¼‰åŒæ­¥
    3. é»˜è®¤æƒ…å†µä¸‹ï¼ŒEffect åœ¨æ¯æ¬¡æ¸²æŸ“ï¼ˆåŒ…æ‹¬åˆå§‹æ¸²æŸ“ï¼‰åè¿è¡Œ
    4. å¦‚æœ React çš„æ‰€æœ‰ä¾èµ–é¡¹éƒ½ä¸ä¸Šæ¬¡æ¸²æŸ“æ—¶çš„å€¼ç›¸åŒï¼Œåˆ™å°†è·³è¿‡æœ¬æ¬¡ Effect
    5. ä¸èƒ½éšæ„é€‰æ‹©ä¾èµ–é¡¹ï¼Œå®ƒä»¬æ˜¯ç”± Effect å†…éƒ¨çš„ä»£ç å†³å®šçš„
    6. ç©ºçš„ä¾èµ–æ•°ç»„ï¼ˆ[]ï¼‰å¯¹åº”äºç»„ä»¶â€œæŒ‚è½½â€ï¼Œå³æ·»åŠ åˆ°å±å¹•ä¸Š
    7. ä»…åœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹çš„å¼€å‘ç¯å¢ƒä¸­ï¼ŒReact ä¼šæŒ‚è½½ä¸¤æ¬¡ç»„ä»¶ï¼Œä»¥å¯¹ Effect è¿›è¡Œå‹åŠ›æµ‹è¯•
    8. å¦‚æœ Effect å› ä¸ºé‡æ–°æŒ‚è½½è€Œä¸­æ–­ï¼Œé‚£ä¹ˆéœ€è¦å®ç°ä¸€ä¸ªæ¸…ç†å‡½æ•°
    9. React å°†åœ¨ä¸‹æ¬¡ Effect è¿è¡Œä¹‹å‰ä»¥åŠå¸è½½æœŸé—´è¿™ä¸¤ä¸ªæ—¶å€™è°ƒç”¨æ¸…ç†å‡½æ•°
*/

import { useEffect, useState } from "react";

{
    // ä¸€èˆ¬æ¥è¯´ï¼ŒEffect ä¼šåœ¨  æ¯æ¬¡ æ¸²æŸ“åæ‰§è¡Œï¼Œè€Œä»¥ä¸‹ä»£ç ä¼šé™·å…¥æ­»å¾ªç¯ä¸­
    function Demo() {
        const [count, setCount] = useState(0);
        useEffect(() => {
            setCount(count + 1);
        });
    }
}

{

    function Demo() {
        const a = 1, b = 2;

        // æ²¡æœ‰ä¾èµ–æ•°ç»„ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ï¼Œä¸ä¾èµ–æ•°ç»„ä½ç©ºæ•°ç»„ [] çš„è¡Œä¸ºæ˜¯ä¸ä¸€è‡´çš„
        useEffect(() => {
            // è¿™é‡Œçš„ä»£ç ä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åæ‰§è¡Œ
        });

        useEffect(() => {
            // è¿™é‡Œçš„ä»£ç åªä¼šåœ¨ç»„ä»¶æŒ‚è½½åæ‰§è¡Œ
        }, []);

        useEffect(() => {
            //è¿™é‡Œçš„ä»£ç åªä¼šåœ¨æ¯æ¬¡æ¸²æŸ“åï¼Œå¹¶ä¸” a æˆ– b çš„å€¼ä¸ä¸Šæ¬¡æ¸²æŸ“ä¸ä¸€è‡´æ—¶æ‰§è¡Œ
        }, [a, b]);
    }
}

{
    /* 
      ä¾èµ–æ•°ç»„ä¸­å¯ä»¥çœç•¥ ref

      å› ä¸º ref å…·æœ‰ ç¨³å®š çš„æ ‡è¯†
      React ä¿è¯ æ¯è½®æ¸²æŸ“ä¸­è°ƒç”¨ useRef æ‰€äº§ç”Ÿçš„å¼•ç”¨å¯¹è±¡æ—¶ï¼Œè·å–åˆ°çš„å¯¹è±¡å¼•ç”¨æ€»æ˜¯ç›¸åŒçš„
      å³è·å–åˆ°çš„å¯¹è±¡å¼•ç”¨æ°¸è¿œä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥å®ƒä¸ä¼šå¯¼è‡´é‡æ–°è¿è¡Œ Effect
      å› æ­¤ï¼Œä¾èµ–æ•°ç»„ä¸­æ˜¯å¦åŒ…å«å®ƒå¹¶ä¸é‡è¦
    */
}

// åœ¨å¼€å‘ç¯å¢ƒä¸­ Effect æ‰§è¡Œä¸¤æ¬¡ 
function Playground() {
    const [text, setText] = useState('a');

    useEffect(() => {
        function onTimeout() { console.log('â° ' + text) }
        console.log('ğŸ”µ å®‰æ’ "' + text + '" æ—¥å¿—');
        const timeoutId = setTimeout(onTimeout, 3000)

        // éœ€è¦è¾“å‡ºæ¸…ç†å‡½æ•°æ¸…ç†æ“ä½œ
        return () => {
            console.log('ğŸŸ¡ å–æ¶ˆ "' + text + '" æ—¥å¿—');
            clearTimeout(timeoutId);
        };
    }, [text])

    return (
        <>
            <label>
                æ—¥å¿—å†…å®¹ï¼š
                <input value={text} onChange={e => setText(e.target.value)} />
            </label>
            <h1>{text}</h1>
        </>
    )
};

function Console() {
    const [show, setShow] = useState(false);
    return (
        <>
            <button onClick={() => setShow(!show)}>
                {show ? 'å¸è½½' : 'æŒ‚è½½'} ç»„ä»¶
            </button>
            {show && <hr />}
            {show && <Playground />}
        </>
    )
};


export default Console;


/* 
  å¤„ç†åœ¨å¼€å‘ç¯å¢ƒä¸­ Effect æ‰§è¡Œä¸¤æ¬¡
    1. å®ç°æ¸…ç†å‡½æ•° æ¸…ç†å‡½æ•°åº”è¯¥åœæ­¢æˆ–æ’¤é”€ Effect æ­£åœ¨æ‰§è¡Œçš„ä»»ä½•æ“ä½œ

    2. å¦‚æœ Effect å°†ä¼šè·å–æ•°æ®ï¼Œæ¸…ç†å‡½æ•°åº”è¯¥è¦ä¹ˆ ä¸­æ­¢è¯¥æ•°æ®è·å–æ“ä½œï¼Œè¦ä¹ˆå¿½ç•¥å…¶ç»“æœ

    3. Effect ä¸­æ•°æ®è·å–æ›¿ä»£æ–¹æ¡ˆå¯ä»¥ä½¿ç”¨æˆ–æ„å»ºå®¢æˆ·ç«¯ç¼“å­˜ ç›®å‰å—æ¬¢è¿çš„å¼€æºè§£å†³æ–¹æ¡ˆæ˜¯ React Queryã€useSWR å’Œ React Router v6.4+

    4. æš‚æ—¶å–æ¶ˆ ä¸¥æ ¼æ¨¡å¼ åŠå…¶ä»…åœ¨å¼€å‘ç¯å¢ƒä¸­é‡æ–°åŠ è½½æ£€æŸ¥

    5. ä¸è¦åœ¨ Effect ä¸­æ‰§è¡Œè´­ä¹°å•†å“ä¸€ç±»çš„æ“ä½œ

*/

{
    // åˆå§‹åŒ–åº”ç”¨æ—¶ä¸éœ€è¦ä½¿ç”¨ Effect çš„æƒ…å½¢
    // æŸäº›é€»è¾‘åº”è¯¥åªåœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶è¿è¡Œä¸€æ¬¡ã€‚æ¯”å¦‚ï¼ŒéªŒè¯ç™»é™†çŠ¶æ€å’ŒåŠ è½½æœ¬åœ°ç¨‹åºæ•°æ®ã€‚ä½ å¯ä»¥å°†å…¶æ”¾åœ¨ç»„ä»¶ä¹‹å¤–

    if (typeof window !== 'undefined') { // æ£€æŸ¥æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­è¿è¡Œ
        // ...
    }

    function App() {
        // â€¦â€¦
    }
}


/* 
  æ‘˜è¦
    1. å¦‚æœä½ å¯ä»¥åœ¨æ¸²æŸ“æœŸé—´è®¡ç®—æŸäº›å†…å®¹ï¼Œåˆ™ä¸éœ€è¦ä½¿ç”¨ Effect
    2. æƒ³è¦ç¼“å­˜æ˜‚è´µçš„è®¡ç®—ï¼Œè¯·ä½¿ç”¨ useMemo è€Œä¸æ˜¯ useEffect
    3. æƒ³è¦é‡ç½®æ•´ä¸ªç»„ä»¶æ ‘çš„ stateï¼Œè¯·ä¼ å…¥ä¸åŒçš„ key
    4. æƒ³è¦åœ¨ prop å˜åŒ–æ—¶é‡ç½®æŸäº›ç‰¹å®šçš„ stateï¼Œè¯·åœ¨æ¸²æŸ“æœŸé—´å¤„ç†
    5. ç»„ä»¶ æ˜¾ç¤º æ—¶å°±éœ€è¦æ‰§è¡Œçš„ä»£ç åº”è¯¥æ”¾åœ¨ Effect ä¸­ï¼Œå¦åˆ™åº”è¯¥æ”¾åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­
    6. å¦‚æœä½ éœ€è¦æ›´æ–°å¤šä¸ªç»„ä»¶çš„ stateï¼Œæœ€å¥½åœ¨å•ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¸­å¤„ç†
    7. å½“ä½ å°è¯•åœ¨ä¸åŒç»„ä»¶ä¸­åŒæ­¥ state å˜é‡æ—¶ï¼Œè¯·è€ƒè™‘çŠ¶æ€æå‡
    8. ä½ å¯ä»¥ä½¿ç”¨ Effect è·å–æ•°æ®ï¼Œä½†ä½ éœ€è¦å®ç°æ¸…é™¤é€»è¾‘ä»¥é¿å…ç«æ€æ¡ä»¶

  æ£€æŸ¥ Effect æ˜¯å¦è¡¨ç¤ºäº†ç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹ã€‚å¦‚æœ Effect æ²¡æœ‰è¿›è¡Œä»»ä½•åŒæ­¥æ“ä½œï¼Œå¯èƒ½æ˜¯ä¸å¿…è¦çš„ã€‚å¦‚æœå®ƒåŒæ—¶è¿›è¡Œäº†å‡ ä¸ªç‹¬ç«‹çš„åŒæ­¥æ“ä½œï¼Œå°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ª Effect

  å¦‚æœæƒ³è¯»å– props æˆ– state çš„æœ€æ–°å€¼ï¼Œä½†åˆä¸æƒ³å¯¹å…¶åšå‡ºååº”å¹¶é‡æ–°åŒæ­¥ Effectï¼Œå¯ä»¥å°† Effect æ‹†åˆ†ä¸ºå…·æœ‰ååº”æ€§çš„éƒ¨åˆ†ï¼ˆä¿ç•™åœ¨ Effect ä¸­ï¼‰å’Œéååº”æ€§çš„éƒ¨åˆ†ï¼ˆæå–ä¸ºåä¸º â€œEffect Eventâ€ çš„å†…å®¹ï¼‰

  é¿å…å°†å¯¹è±¡å’Œå‡½æ•°ä½œä¸ºä¾èµ–é¡¹ã€‚å¦‚æœåœ¨æ¸²æŸ“è¿‡ç¨‹ä¸­åˆ›å»ºå¯¹è±¡å’Œå‡½æ•°ï¼Œç„¶ååœ¨ Effect ä¸­è¯»å–å®ƒä»¬ï¼Œå®ƒä»¬å°†åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¸åŒã€‚è¿™å°†å¯¼è‡´ Effect æ¯æ¬¡éƒ½é‡æ–°åŒæ­¥
*/


/* 
  Reactç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
    1. å½“ç»„ä»¶è¢«æ·»åŠ åˆ°å±å¹•ä¸Šæ—¶ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ æŒ‚è½½
    2. å½“ç»„ä»¶æ¥æ”¶åˆ°æ–°çš„ props æˆ– state æ—¶ï¼Œé€šå¸¸æ˜¯ä½œä¸ºå¯¹äº¤äº’çš„å“åº”ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ æ›´æ–°
    3. å½“ç»„ä»¶ä»å±å¹•ä¸Šç§»é™¤æ—¶ï¼Œå®ƒä¼šè¿›è¡Œç»„ä»¶çš„ å¸è½½

  å“åº”å¼Effectç”Ÿå‘½å‘¨æœŸ
    1. æ¯ä¸ª Effect ä¸å‘¨å›´ç»„ä»¶æœ‰ç€ç‹¬ç«‹çš„ç”Ÿå‘½å‘¨æœŸ
    2. æ¯ä¸ª Effect æè¿°äº†ä¸€ä¸ªç‹¬ç«‹çš„åŒæ­¥è¿‡ç¨‹ï¼Œå¯ä»¥ å¼€å§‹ å’Œ åœæ­¢
    3. åœ¨ç¼–å†™å’Œè¯»å– Effect æ—¶ï¼Œè¦ç‹¬ç«‹åœ°è€ƒè™‘æ¯ä¸ª Effectï¼ˆå¦‚ä½•å¼€å§‹å’Œåœæ­¢åŒæ­¥ï¼‰ï¼Œè€Œä¸æ˜¯ä»ç»„ä»¶çš„è§’åº¦æ€è€ƒï¼ˆå¦‚ä½•æŒ‚è½½ã€æ›´æ–°æˆ–å¸è½½ï¼‰
    4. åœ¨ç»„ä»¶ä¸»ä½“å†…å£°æ˜çš„å€¼æ˜¯â€œå“åº”å¼â€çš„
    5. å“åº”å¼å€¼åº”è¯¥é‡æ–°è¿›è¡ŒåŒæ­¥ Effectï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥éšç€æ—¶é—´çš„æ¨ç§»è€Œå‘ç”Ÿå˜åŒ–
    6. æ£€æŸ¥å·¥å…·éªŒè¯åœ¨ Effect å†…éƒ¨ä½¿ç”¨çš„æ‰€æœ‰å“åº”å¼å€¼éƒ½è¢«æŒ‡å®šä¸ºä¾èµ–é¡¹
    7. æ£€æŸ¥å·¥å…·æ ‡è®°çš„æ‰€æœ‰é”™è¯¯éƒ½æ˜¯åˆç†çš„ã€‚æ€»æ˜¯æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥ä¿®å¤ä»£ç ï¼ŒåŒæ—¶ä¸è¿åè§„åˆ™
*/


{
    // å½“ä½ ä¸æƒ³è¿›è¡Œé‡æ–°åŒæ­¥æ—¶ å¯ä»¥é€šè¿‡å‘æ£€æŸ¥å·¥å…·â€œè¯æ˜â€è¿™äº›å€¼ä¸æ˜¯å“åº”å¼å€¼
    function Demo() {
        useEffect(() => {
            const serverUrl = 'https://localhost:1234'; // serverUrl ä¸æ˜¯å“åº”å¼çš„
            const roomId = 'general'; // roomId ä¸æ˜¯å“åº”å¼çš„
            const connection = createConnection(serverUrl, roomId);
            connection.connect();
            return () => { connection.disconnect() };
        }, []); // âœ… å£°æ˜çš„æ‰€æœ‰ä¾èµ–
        // ...
    }
}